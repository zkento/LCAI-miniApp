# 良策AI小程序 - 移植项目实施方案

本文档旨在为"良策AI"从Web端向微信小程序端的移植工作，提供一份清晰、可控、分阶段的实施方案。方案的核心目标是确保开发节奏稳健、各阶段成果可量化、交付质量有保障。

## 1. 总体阶段划分

为确保复杂项目能够平稳、有序地推进，我们将整个移植工作划分为 **六个** 核心阶段。每个阶段都有明确的目标和交付产物，后续阶段将严格依赖前一阶段的完成和验收。

*   **阶段一：项目奠基与环境搭建**
*   **阶段二：后端BFF部署与联调准备**
*   **阶段三：核心UI框架与静态页面构建**
*   **阶段四：技术核心验证与全业务流程贯通**
*   **阶段五：辅助功能模块开发**
*   **阶段六：整合、优化与验收准备**

---

## 2. 各阶段详细规划

### 阶段一：项目奠基与环境搭建

*   **目标**：创建小程序项目，完成基础配置和技术选型，为后续开发铺平道路。
*   **具体工作任务**：
    1.  初始化微信小程序项目，建立标准的目录结构（`pages`, `components`, `services`, `utils`等）。
    2.  配置`app.json`，注册所有未来规划的页面路径，并完成窗口、导航栏等全局设置。
    3.  引入并配置一个UI组件库（如`Vant Weapp`），以统一UI风格、提高开发效率。
    4.  引入并配置`TypeScript`，为项目提供类型安全保障。
*   **完成标准**：
    1.  项目代码可以在微信开发者工具中无错误地编译和运行。
    2.  `app.json`中已包含所有规划页面的路径。
    3.  UI库已成功引入，其任意一个组件（如Button）可以在测试页面上正常渲染和使用。
*   **如何自测与交付验收**：
    *   **自测过程**：我会创建一个`pages/test/test`页面，在该页面上同时放置一个Vant Weapp的按钮组件和一个我编写的自定义组件。
    *   **交付物**：一张清晰的**截图**，展示`test`页面在微信开发者工具模拟器中的运行效果，证明UI库和自定义组件均可正常工作。

### 阶段二：后端BFF部署与联调准备

*   **目标**：确保小程序可以访问到一个正常运行的BFF服务，打通前后端网络通信。
*   **具体工作任务**：
    1.  整理`liangceAI`后端代码，编写一份清晰的`README.md`，说明如何安装依赖 (`npm install`) 和启动服务 (`npm start`)。
    2.  修改`server.js`中的CORS配置，确保允许来自`servicewechat.com`的跨域请求。
    3.  在`server.js`中增加一个用于测试的、简单的`GET`接口：`/api/health-check`，该接口返回固定的JSON：`{ status: 'ok', message: 'BFF service is running' }`。
*   **完成标准**：
    1.  BFF项目的`README.md`文档清晰、完整。
    2.  在本地成功启动BFF服务后，可以通过浏览器或Postman访问`http://localhost:3000/api/health-check`并得到正确的JSON返回。
*   **如何自测与交付验收**：
    *   **自测过程**：我会在小程序的`test`页面上添加一个"测试后端连接"的按钮。点击该按钮会触发`wx.request`，请求本地运行的BFF的`/api/health-check`接口。
    *   **交付物**：一张清晰的**截图**，左边是显示BFF服务已在终端中运行的日志，右边是微信开发者工具的控制台（Console），**明确打印出从小程序端成功接收到的`{ status: 'ok', ... }`对象**。

### 阶段三：核心UI框架与静态页面构建

*   **目标**：完成应用的主要导航结构和无动态逻辑的静态页面，搭建起应用的"骨架"。
*   **具体工作任务**：
    1.  开发首页`pages/home/home`，使用UI库组件构建四个功能入口的卡片式布局。
    2.  开发分析页`pages/analyse/analyse`的静态骨架，包含顶部的步骤条和用于承载表单、报告的布局容器。
    3.  实现从首页到分析页的导航逻辑，确保点击不同卡片时，能将对应的业务类型（如`type=personal-credit`）作为参数正确传递。
*   **完成标准**：
    1.  首页UI与Web端视觉效果基本一致。
    2.  分析页能够正确接收并显示从首页传递来的参数（如在页面标题上显示"个人征信分析"）。
    3.  页面间的跳转流畅，无错误。
*   **如何自测与交付验收**：
    *   **自测过程**：我会完整地操作一遍"打开小程序 -> 查看首页 -> 点击'企业征信分析'卡片 -> 进入分析页"的流程。
    *   **交付物**：一段**GIF动图**或短视频，清晰地演示上述完整的导航流程，并展示分析页的标题已根据点击的卡片动态变化。

### 阶段四：技术核心验证与全业务流程贯通

*   **目标**：完成所有四个核心业务从前端到后端的全流程贯通。此阶段将优先集中资源打通一个最复杂的业务（如个人征信）作为"技术样板"，然后将其成功模式快速复用到其余三个业务上。
*   **具体工作任务**：
    1.  **技术样板实现 (个人征信分析)**:
        *   在分析页中，实现`creditAnalyseForm`（征信分析表单）的完整UI和交互逻辑，包括图片拖拽排序。
        *   实现调用`wx.uploadFile`上传文件至BFF的功能。
        *   实现调用BFF流式接口，并实时在界面上展示"AI思考过程"的打字机效果。
        *   引入Markdown渲染组件，将AI返回的最终报告正确渲染出来。
        *   实现报告页下方的"继续咨询"聊天框功能。
    2.  **业务流程复用**:
        *   在分析页中，实现`FinanceAdvisorForm`和`PropertyAdvisorForm`的UI和复杂交互逻辑（如AI预分析、关联历史报告等）。
        *   确保这三个不同的表单可以根据页面参数动态地、正确地显示。
        *   将已验证成功的"流式响应->报告渲染->继续咨询"逻辑，完整地应用到所有四项业务中。
*   **完成标准**：
    1.  **所有四个核心业务**（个人征信、企业征信、融资顾问、房产顾问）均可从首页入口进入，并完成从输入到生成报告的全流程。
    2.  Web端的所有核心交互（如拖拽排序、AI预分析、关联历史报告、继续咨询等）均已在小程序中实现。
    3.  整个流程中，数据流转正确，无明显的功能性BUG。
*   **如何自测与交付验收**：
    *   **自测过程**：我会为**每一个核心业务**都准备独立的测试用例（测试文件或输入文本），并逐一完整地跑通端到端全流程。
    *   **交付物**：**四段独立的屏幕录像视频**。每一段视频对应一个核心业务，清晰地记录从"点击首页卡片"开始，到"完成信息输入"，再到"展示最终报告"的完整用户旅程。以此证明所有功能均已完整移植并成功打通。

### 阶段五：辅助功能模块开发

*   **目标**：完成除核心分析流程外的其他独立功能模块。
*   **具体工作任务**：
    1.  开发`pages/tools/loanCalculator`贷款计算器页面，移植Web端的计算逻辑和动态表单交互。
    2.  开发"历史记录"功能，包括一个可复用的历史列表组件，并实现筛选和上拉加载更多功能。
    3.  开发`pages/result/result`历史结果查看页面，用于展示历史任务的详情。
    4.  开发全局AI聊天组件（悬浮按钮 + 半屏弹窗）。
*   **完成标准**：
    1.  贷款计算器功能完善，计算结果准确。
    2.  历史记录列表能展示任务，并能通过点击跳转到结果查看页。
    3.  全局AI聊天按钮可见，点击可正常弹出聊天窗口。
*   **如何自测与交付验收**：
    *   **自测过程**：我会对这三个功能模块分别进行独立的单元功能测试。
    *   **交付物**：三份独立的交付物。可以是**三张关键功能的截图**（如贷款计算器算出一个结果的截图），或是**三个独立的短GIF动图**，分别演示贷款计算器、历史记录、全局AI聊天的核心交互。

### 阶段六：整合、优化与验收准备

*   **目标**：对整个应用进行最后的打磨、性能优化和错误处理，确保产品达到可交付状态。
*   **具体工作任务**：
    1.  全面检查并实现所有在《技术方案.md》中规划的UI/UX微交互和动画效果。
    2.  对所有页面进行性能优化，包括减少不必要的`setData`、使用分包加载等。
    3.  为所有API请求添加完善的错误处理和用户提示（如网络错误、服务器500等）。
    4.  清理所有测试代码和日志，整理代码格式。
    5.  编写一份最终的《小程序使用说明.md》。
*   **完成标准**：
    1.  应用运行流畅，无明显卡顿。
    2.  所有交互都符合设计稿的预期效果。
    3.  在弱网或接口报错等异常情况下，应用有合理的降级表现和用户提示。
    4.  代码整洁，无冗余。
*   **如何自测与交付验收**：
    *   **自测过程**：我会使用微信开发者工具中的"性能分析"和"网络模拟"工具，检查关键页面的加载性能和在不同网络状况下的表现。同时，我会手动模拟接口报错等异常情况。
    *   **交付物**：一份**《最终交付报告》**。报告中将包含：
        *   关键页面的**性能分析截图**。
        *   应用在**弱网和接口报错情况下的表现截图**。
        *   一份完整的**《小程序使用说明.md》**。
        *   最终确认，我已准备好将项目完整交付给您进行验收。 